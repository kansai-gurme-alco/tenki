<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ã‚¤ãƒ³ã‚¹ã‚¿æŠ•ç¨¿ã‚­ãƒ£ãƒ—ã‚·ãƒ§ãƒ³ç”Ÿæˆãã‚“ V2</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;700&display=swap');
        body { font-family: 'Noto Sans JP', sans-serif; }
        .loading-spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            width: 36px;
            height: 36px;
            border-radius: 50%;
            border-left-color: #E11D48;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen pb-12 text-gray-800">

    <!-- Header -->
    <nav class="bg-white shadow-sm border-b px-4 py-4 mb-6 sticky top-0 z-10">
        <div class="max-w-5xl mx-auto flex justify-between items-center">
            <h1 class="text-xl font-bold bg-gradient-to-r from-rose-500 to-orange-500 bg-clip-text text-transparent">
                ğŸ“¸ ã‚¤ãƒ³ã‚¹ã‚¿æŠ•ç¨¿ç”Ÿæˆ V2
            </h1>
            <div class="flex gap-2">
                <a href="https://aistudio.google.com/app/apikey" target="_blank" class="text-xs bg-gray-800 text-white px-3 py-2 rounded-lg hover:bg-gray-700 transition">
                    APIã‚­ãƒ¼å–å¾—
                </a>
            </div>
        </div>
    </nav>

    <main class="max-w-5xl mx-auto px-4">
        
        <!-- API Setting Section -->
        <section id="api-section" class="bg-white p-5 rounded-2xl shadow-sm border mb-6">
            <div class="flex flex-col sm:flex-row gap-3 items-center">
                <div class="flex-1 w-full">
                    <input type="password" id="api-key-input" placeholder="Google Gemini APIã‚­ãƒ¼ã‚’å…¥åŠ›" 
                        class="w-full border border-gray-300 rounded-xl px-4 py-2 focus:ring-2 focus:ring-rose-500 outline-none">
                </div>
                <button id="save-api-btn" class="w-full sm:w-auto bg-gray-800 text-white px-6 py-2 rounded-xl hover:bg-black transition font-medium">
                    ã‚­ãƒ¼ã‚’ä¿å­˜
                </button>
            </div>
            <p id="api-status" class="mt-2 text-xs text-gray-500"></p>
        </section>

        <div class="grid grid-cols-1 lg:grid-cols-5 gap-6">
            
            <!-- Left: Input Form (2 cols) -->
            <section class="lg:col-span-2 space-y-6">
                <div class="bg-white p-6 rounded-2xl shadow-sm border">
                    <h2 class="text-lg font-bold mb-4 flex items-center gap-2">ğŸ  åº—èˆ—ãƒ»èª¿æŸ»è¨­å®š</h2>
                    
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">åº—åï¼ˆå ´æ‰€ï¼‹åº—åãŒãŠã™ã™ã‚ï¼‰</label>
                            <input type="text" id="shop-name" placeholder="ä¾‹ï¼šå¿ƒæ–æ©‹ ç„¼è‚‰ ã€‡ã€‡" 
                                class="w-full border border-gray-300 rounded-xl px-4 py-3 focus:ring-2 focus:ring-rose-500 outline-none">
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">æ³¨æ–‡ãƒ¡ãƒ‹ãƒ¥ãƒ¼ãƒ»èª¿æŸ»è¦æœ›</label>
                            <textarea id="menu-request" rows="3" placeholder="ä¾‹ï¼šç‰¹ä¸Šãƒ­ãƒ¼ã‚¹ã¨å†·éººã€‚å€¤æ®µã‚„è‚‰ã®è³ªæ„Ÿã‚’è©³ã—ãã€‚ãƒ©ãƒ³ãƒã®ã‚³ã‚¹ãƒ‘ã¯ã©ã†ï¼Ÿ" 
                                class="w-full border border-gray-300 rounded-xl px-4 py-3 focus:ring-2 focus:ring-rose-500 outline-none"></textarea>
                            <p class="text-[10px] text-gray-400 mt-1">â€»ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã®å…·ä½“çš„ãªæ„Ÿæƒ³ã‚„ä¾¡æ ¼å¸¯ã‚’AIãŒé‡ç‚¹èª¿æŸ»ã—ã¾ã™</p>
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">ãã®ä»–è£œè¶³ï¼ˆä»»æ„ï¼‰</label>
                            <input type="text" id="additional-info" placeholder="ä¾‹ï¼šãƒ‡ãƒ¼ãƒˆã«ãŠã™ã™ã‚ç­‰" 
                                class="w-full border border-gray-300 rounded-xl px-4 py-3 focus:ring-2 focus:ring-rose-500 outline-none">
                        </div>

                        <button id="generate-btn" class="w-full bg-gradient-to-r from-rose-500 to-orange-500 text-white font-bold py-4 rounded-xl shadow-lg hover:opacity-90 transition transform active:scale-95 flex justify-center items-center gap-2">
                            <span>ğŸš€ èª¿æŸ»ã‚’é–‹å§‹ã™ã‚‹</span>
                        </button>
                    </div>
                </div>
            </section>

            <!-- Right: Output Area (3 cols) -->
            <section class="lg:col-span-3">
                <div class="bg-white p-6 rounded-2xl shadow-sm border h-full flex flex-col min-h-[600px]">
                    <div class="flex justify-between items-center mb-4">
                        <h2 class="text-lg font-bold">ğŸ“ ç”Ÿæˆã•ã‚ŒãŸã‚­ãƒ£ãƒ—ã‚·ãƒ§ãƒ³</h2>
                        <button id="copy-btn" class="bg-rose-50 text-rose-600 px-4 py-2 rounded-xl hover:bg-rose-100 transition font-bold flex items-center gap-2">
                            <span>ğŸ“‹ ã‚³ãƒ”ãƒšã™ã‚‹</span>
                        </button>
                    </div>
                    
                    <div id="loading-area" class="hidden flex-1 flex flex-col items-center justify-center text-gray-500">
                        <div class="loading-spinner mb-4"></div>
                        <p class="font-medium">Googleæ¤œç´¢ã§æœ€æ–°æƒ…å ±ã‚’èª¿æŸ»ä¸­...</p>
                        <p class="text-xs mt-2 text-gray-400">ã“ã‚Œã«ã¯15ã€œ30ç§’ã»ã©ã‹ã‹ã‚‹å ´åˆãŒã‚ã‚Šã¾ã™</p>
                    </div>

                    <div id="output-area" class="flex-1">
                        <textarea id="result-text" readonly 
                            class="w-full h-full min-h-[500px] bg-gray-50 border-none resize-none p-5 rounded-xl text-gray-800 leading-relaxed text-sm focus:outline-none"
                            placeholder="åº—èˆ—åã‚’å…¥åŠ›ã—ã¦ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦ãã ã•ã„"></textarea>
                    </div>
                </div>
            </section>
        </div>
    </main>

    <!-- Toast Notification -->
    <div id="toast" class="fixed bottom-10 left-1/2 transform -translate-x-1/2 bg-gray-900 text-white px-8 py-3 rounded-full shadow-2xl transition-opacity opacity-0 pointer-events-none z-50">
        ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼
    </div>

    <script>
        const STORAGE_KEY = 'GEMINI_API_KEY_INSTA_V2';
        const MODEL_NAME = 'gemini-2.5-flash-preview-09-2025';
        let apiKey = localStorage.getItem(STORAGE_KEY) || "";

        // UI Elements
        const apiKeyInput = document.getElementById('api-key-input');
        const saveApiBtn = document.getElementById('save-api-btn');
        const apiStatus = document.getElementById('api-status');
        const shopNameInput = document.getElementById('shop-name');
        const menuRequestInput = document.getElementById('menu-request');
        const additionalInfoInput = document.getElementById('additional-info');
        const generateBtn = document.getElementById('generate-btn');
        const resultText = document.getElementById('result-text');
        const loadingArea = document.getElementById('loading-area');
        const outputArea = document.getElementById('output-area');
        const copyBtn = document.getElementById('copy-btn');
        const toast = document.getElementById('toast');

        if (apiKey) {
            apiKeyInput.value = apiKey;
            apiStatus.textContent = "âœ… APIã‚­ãƒ¼è¨­å®šæ¸ˆã¿";
        }

        saveApiBtn.onclick = () => {
            const val = apiKeyInput.value.trim();
            if (val) {
                apiKey = val;
                localStorage.setItem(STORAGE_KEY, val);
                apiStatus.textContent = "âœ… ã‚­ãƒ¼ã‚’ä¿å­˜ã—ã¾ã—ãŸ";
                showToast("APIã‚­ãƒ¼ã‚’ä¿å­˜ã—ã¾ã—ãŸ");
            }
        };

        copyBtn.onclick = () => {
            if (!resultText.value) return;
            resultText.select();
            document.execCommand('copy');
            showToast("ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼");
        };

        function showToast(msg) {
            toast.textContent = msg;
            toast.classList.remove('opacity-0');
            setTimeout(() => toast.classList.add('opacity-0'), 2000);
        }

        async function generateCaption() {
            if (!apiKey) {
                alert("APIã‚­ãƒ¼ã‚’ä¿å­˜ã—ã¦ã‹ã‚‰å®Ÿè¡Œã—ã¦ãã ã•ã„ã€‚");
                return;
            }
            if (!shopNameInput.value.trim()) {
                alert("åº—åã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚");
                return;
            }

            loadingArea.classList.remove('hidden');
            outputArea.classList.add('hidden');
            generateBtn.disabled = true;

            const shopName = shopNameInput.value.trim();
            const menuReq = menuRequestInput.value.trim();
            const addInfo = additionalInfoInput.value.trim();

            const systemPrompt = `ã‚ãªãŸã¯é–¢è¥¿ã®ã‚°ãƒ«ãƒ¡æƒ…å ±ã‚’ç´¹ä»‹ã™ã‚‹ãƒ—ãƒ­ã®ã‚¤ãƒ³ã‚¹ã‚¿ã‚°ãƒ©ãƒãƒ¼ã€Œï¼ kansai_gurme_alcoã€ã§ã™ã€‚
Googleæ¤œç´¢ã‚’ä½¿ç”¨ã—ã€æŒ‡å®šã•ã‚ŒãŸåº—èˆ—ã¨ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã«ã¤ã„ã¦æœ€æ–°æƒ…å ±ã‚’èª¿æŸ»ã—ã€æœ€é«˜å“è³ªã®ã‚­ãƒ£ãƒ—ã‚·ãƒ§ãƒ³ã‚’ä½œæˆã—ã¦ãã ã•ã„ã€‚

### èª¿æŸ»ãƒ»åŸ·ç­†ã®ãƒ«ãƒ¼ãƒ«
1. ã€æ„Ÿæƒ³ã€‘æ¬„ã¯ã€å®Ÿéš›ã«é£Ÿã¹ãŸäººã®å£ã‚³ãƒŸã‚„ãƒ–ãƒ­ã‚°ã‹ã‚‰è¡¨ç¾ã‚’æ‹¾ã£ã¦ãã ã•ã„ã€‚ã€Œç¾å‘³ã—ã„ã€ã¨ã„ã†è¨€è‘‰ã‚’é¿ã‘ã€ã€Œå£ã®ä¸­ã§ã¨ã‚ã‘ã‚‹ã€ã€Œã‚¹ãƒ‘ã‚¤ã‚¹ã®é¦™ã‚ŠãŒé¼»ã‚’æŠœã‘ã‚‹ã€ã€Œå¤–ã¯ã‚«ãƒªãƒƒã¨ã€ä¸­ã¯ã‚¸ãƒ¥ãƒ¯ãƒƒã¨ã€ãªã©ã®å…·ä½“çš„ã§ã‚·ã‚ºãƒ«æ„Ÿã®ã‚ã‚‹è¡¨ç¾ã‚’å¤šç”¨ã—ã€é•·ã‚ã«æ›¸ã„ã¦ãã ã•ã„ã€‚
2. è¦æœ›ã«ã‚ã‚‹ã€Œãƒ¡ãƒ‹ãƒ¥ãƒ¼åã€ã«ã¤ã„ã¦ã¯ã€ä¾¡æ ¼ã‚„ãã®ãƒ¡ãƒ‹ãƒ¥ãƒ¼ç‰¹æœ‰ã®ã“ã ã‚ã‚Šã‚’é‡ç‚¹çš„ã«èª¿ã¹ã¦åæ˜ ã•ã›ã¦ãã ã•ã„ã€‚
3. ã€å®¢å±¤ã€‘ã¯ã€ã©ã®ã‚ˆã†ãªå±¤ãŒå¤šã„ã‹ï¼ˆä¾‹ï¼š20ä»£å¥³å­ã€ã‚µãƒ©ãƒªãƒ¼ãƒãƒ³ã€ãŠä¸€äººæ§˜ãªã©ï¼‰ã‚’åˆ†æã—ã€3ã¤ã®ç®‡æ¡æ›¸ãã§å‡ºã—ã¦ãã ã•ã„ã€‚
4. ã€é›°å›²æ°—ã€‘ã¯ã€åº—å†…ãŒã©ã®ã‚ˆã†ãªæ„Ÿã˜ã‹1è¡Œã€œ2è¡Œã§ç°¡æ½”ã«ã€‚
5. ã€ã‚ªã‚¹ã‚¹ãƒ¡ãƒã‚¤ãƒ³ãƒˆã€‘ã¯ã€ãã®åº—ã®å¼·ã¿ã‚’3ã¤ã€ğŸ”¸ã‚’ä½¿ã£ã¦è¡¨ç¾ã—ã¦ãã ã•ã„ã€‚
6. æœ€å¾Œã«ã€ãã®åº—ã«é–¢é€£ã™ã‚‹ãƒˆãƒ¬ãƒ³ãƒ‰ã®ãƒãƒƒã‚·ãƒ¥ã‚¿ã‚°ã‚’5ã¤è¿½åŠ ã—ã¦ãã ã•ã„ã€‚

### å‡ºåŠ›ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
ã‚‚ã—æ°—ã«ãªã£ãŸã‚‰ä¿å­˜ã‚’ã‚¿ãƒƒãƒ—ï¼
æ¬¡ã®æŠ•ç¨¿ã‚‚æ°—ã«ãªã£ãŸã‚‰ãƒ•ã‚©ãƒ­ãƒ¼ãŠé¡˜ã„ã—ã¾ã™ğŸ”¥
â†’@kansai_gurme_alco

ã€ã‚ªã‚¹ã‚¹ãƒ¡ãƒã‚¤ãƒ³ãƒˆã€‘
ğŸ”¸[ãƒã‚¤ãƒ³ãƒˆ1]
ğŸ”¸[ãƒã‚¤ãƒ³ãƒˆ2]
ğŸ”¸[ãƒã‚¤ãƒ³ãƒˆ3]

ã€æ„Ÿæƒ³ã€‘
[ã“ã“ã«é•·æ–‡ã®ã‚·ã‚ºãƒ«æ„Ÿã‚ã‚‹æ„Ÿæƒ³ã‚’è¨˜è¼‰ã€‚ãƒãƒƒãƒˆã®å£ã‚³ãƒŸã‚’åˆ†æã—ãŸå…·ä½“çš„ãªè¡¨ç¾ã‚’ä½¿ã†ã“ã¨ã€‚]

ã€å®¢å±¤ã€‘
ãƒ»
ãƒ»
ãƒ»

ã€é›°å›²æ°—ã€‘
[ç°¡æ½”ã«è¨˜è¼‰]

â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”
ğŸ“åº—æƒ…å ±
åº—åï¼š[åº—å]
ä½æ‰€ï¼š[ä½æ‰€]
å–¶æ¥­ï¼š[å–¶æ¥­æ™‚é–“]
â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”
é–¢è¥¿ã®ã‚°ãƒ«ãƒ¡æƒ…å ±ã‚’ç™ºä¿¡ä¸­ï¼
å±…é…’å±‹ã€ã‚«ãƒ•ã‚§ã€è“å­ç³»ã€ä¼šé£Ÿã«åˆ©ç”¨ã§ãã‚‹ãŠåº—ã‚’ç´¹ä»‹ï¼
â†“
@kansai_gurme_alco

#[ã‚¿ã‚°1] #[ã‚¿ã‚°2] #[ã‚¿ã‚°3] #[ã‚¿ã‚°4] #[ã‚¿ã‚°5]`;

            const userQuery = `åº—å: ${shopName}\nè¦æœ›/ãƒ¡ãƒ‹ãƒ¥ãƒ¼: ${menuReq}\nè£œè¶³: ${addInfo}`;

            try {
                const response = await fetchWithRetry(
                    `https://generativelanguage.googleapis.com/v1beta/models/${MODEL_NAME}:generateContent?key=${apiKey}`,
                    {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            contents: [{ parts: [{ text: userQuery }] }],
                            systemInstruction: { parts: [{ text: systemPrompt }] },
                            tools: [{ google_search: {} }]
                        })
                    }
                );

                const data = await response.json();
                const text = data.candidates?.[0]?.content?.parts?.[0]?.text;

                if (text) {
                    resultText.value = text.trim();
                } else {
                    throw new Error("ç”Ÿæˆã«å¤±æ•—ã—ã¾ã—ãŸã€‚å†…å®¹ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚");
                }

            } catch (error) {
                console.error(error);
                resultText.value = "ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸï¼š\n" + error.message;
            } finally {
                loadingArea.classList.add('hidden');
                outputArea.classList.remove('hidden');
                generateBtn.disabled = false;
            }
        }

        async function fetchWithRetry(url, options, retries = 5) {
            let delay = 1000;
            for (let i = 0; i < retries; i++) {
                try {
                    const res = await fetch(url, options);
                    if (res.ok) return res;
                    if (res.status === 429 || res.status >= 500) {
                        // Retry
                    } else {
                        const errData = await res.json();
                        throw new Error(errData.error?.message || "é€šä¿¡ã‚¨ãƒ©ãƒ¼");
                    }
                } catch (e) {
                    if (i === retries - 1) throw e;
                }
                await new Promise(r => setTimeout(r, delay));
                delay *= 2;
            }
        }

        generateBtn.onclick = generateCaption;
    </script>
</body>
</html>

