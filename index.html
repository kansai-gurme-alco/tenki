<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ã‚¤ãƒ³ã‚¹ã‚¿æŠ•ç¨¿ã‚­ãƒ£ãƒ—ã‚·ãƒ§ãƒ³ç”Ÿæˆãã‚“ V3</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;700&display=swap');
        body { font-family: 'Noto Sans JP', sans-serif; }
        .loading-spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border-left-color: #F43F5E;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        textarea::-webkit-scrollbar {
            width: 8px;
        }
        textarea::-webkit-scrollbar-thumb {
            background: #e2e8f0;
            border-radius: 4px;
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen text-gray-800">

    <nav class="bg-white shadow-sm border-b px-6 py-4 sticky top-0 z-50">
        <div class="max-w-6xl mx-auto flex flex-col sm:flex-row justify-between items-center gap-4">
            <h1 class="text-xl font-bold bg-gradient-to-r from-rose-500 to-orange-500 bg-clip-text text-transparent">
                ğŸ“¸ ã‚¤ãƒ³ã‚¹ã‚¿æŠ•ç¨¿ç”Ÿæˆ V3
            </h1>
            <div class="flex items-center gap-3">
                <!-- APIå–å¾—ãƒœã‚¿ãƒ³ã‚’åˆ†ã‹ã‚Šã‚„ã™ãä¿®æ­£ -->
                <a href="https://aistudio.google.com/app/apikey" target="_blank" class="bg-orange-500 text-white px-5 py-2 rounded-xl hover:bg-orange-600 transition font-bold text-sm shadow-md flex items-center gap-2">
                    ğŸ”‘ APIã‚­ãƒ¼ã‚’å–å¾—ã—ã«è¡Œã
                </a>
                <button id="copy-btn" class="bg-gray-100 text-gray-700 px-5 py-2 rounded-xl hover:bg-gray-200 transition font-bold text-sm">
                    ğŸ“‹ ã‚³ãƒ”ãƒš
                </button>
            </div>
        </div>
    </nav>

    <main class="max-w-6xl mx-auto px-4 py-8">
        <div class="grid grid-cols-1 lg:grid-cols-12 gap-8">
            
            <!-- Left Panel -->
            <div class="lg:col-span-5 space-y-6">
                <!-- API Setting Section -->
                <div class="bg-white p-5 rounded-3xl shadow-sm border">
                    <label class="block text-xs font-bold text-gray-400 uppercase mb-2 ml-1">APIã‚­ãƒ¼ã‚’ã“ã“ã§ä¿å­˜</label>
                    <div class="flex gap-2">
                        <input type="password" id="api-key-input" placeholder="å–å¾—ã—ãŸã‚­ãƒ¼ã‚’ã“ã“ã«è²¼ã‚Šä»˜ã‘" 
                            class="flex-1 border border-gray-200 rounded-2xl px-4 py-2 text-sm focus:ring-2 focus:ring-rose-500 outline-none">
                        <button id="save-api-btn" class="bg-gray-800 text-white px-4 py-2 rounded-2xl hover:bg-black transition text-sm whitespace-nowrap">
                            ä¿å­˜
                        </button>
                    </div>
                </div>

                <!-- Input Form -->
                <div class="bg-white p-6 rounded-3xl shadow-sm border space-y-5">
                    <h2 class="text-lg font-bold border-l-4 border-rose-500 pl-3 text-gray-700">åº—èˆ—ãƒ»ãƒ¡ãƒ‹ãƒ¥ãƒ¼èª¿æŸ»</h2>
                    
                    <div>
                        <label class="block text-sm font-bold text-gray-700 mb-2">åº—å</label>
                        <input type="text" id="shop-name" placeholder="ä¾‹ï¼šå®ˆå£ ç«‹ã¡å‘‘ã¿ ãƒ¨ãƒƒã‚³ã‚¤ã‚·ãƒ§" 
                            class="w-full border border-gray-200 rounded-2xl px-4 py-3 focus:ring-2 focus:ring-rose-500 outline-none transition">
                    </div>

                    <div>
                        <label class="block text-sm font-bold text-gray-700 mb-2">é£Ÿã¹ãŸã‚‚ã®ãƒ»èª¿æŸ»è¦æœ›</label>
                        <textarea id="menu-request" rows="4" placeholder="ä¾‹ï¼šè‚‰åˆºã—ç››ã‚Šã€ç‡»è£½3ç¨®ç››ã‚Šã€‚å€¤æ®µã¨å‘³ã®æ„Ÿæƒ³ã‚’è©³ã—ãï¼" 
                            class="w-full border border-gray-200 rounded-2xl px-4 py-3 focus:ring-2 focus:ring-rose-500 outline-none transition"></textarea>
                    </div>

                    <div>
                        <label class="block text-sm font-bold text-gray-700 mb-2">è£œè¶³ï¼ˆåº—ã®é›°å›²æ°—ã®è¦æœ›ãªã©ï¼‰</label>
                        <input type="text" id="additional-info" placeholder="ä¾‹ï¼šã‚¦ãƒƒãƒ‡ã‚£ã§ãŠæ´’è½ãªæ„Ÿã˜" 
                            class="w-full border border-gray-200 rounded-2xl px-4 py-3 focus:ring-2 focus:ring-rose-500 outline-none transition">
                    </div>

                    <button id="generate-btn" class="w-full bg-gradient-to-br from-rose-500 to-orange-500 text-white font-bold py-4 rounded-2xl shadow-lg hover:shadow-xl transition transform active:scale-[0.98] flex justify-center items-center gap-2">
                        <span>ğŸš€ ãƒãƒƒãƒˆèª¿æŸ»ã‚’é–‹å§‹</span>
                    </button>
                </div>
            </div>

            <!-- Right Panel (Output) -->
            <div class="lg:col-span-7">
                <div class="bg-white p-6 rounded-3xl shadow-sm border h-full flex flex-col min-h-[700px]">
                    <div id="loading-area" class="hidden flex-1 flex flex-col items-center justify-center text-gray-500">
                        <div class="loading-spinner mb-6"></div>
                        <p class="text-lg font-bold text-gray-700">æœ€æ–°æƒ…å ±ã‚’ãƒªã‚µãƒ¼ãƒä¸­...</p>
                        <p class="text-sm mt-2 text-gray-400 text-center">ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã®ä¾¡æ ¼ã‚„å£ã‚³ãƒŸã‚’åˆ†æã—ã¦ã„ã¾ã™ã€‚<br>15ã€œ30ç§’ã»ã©ãŠå¾…ã¡ãã ã•ã„ã€‚</p>
                    </div>

                    <div id="output-area" class="flex-1 flex flex-col">
                        <textarea id="result-text" readonly 
                            class="w-full flex-1 bg-gray-50 border-none resize-none p-6 rounded-2xl text-gray-800 leading-relaxed text-[15px] focus:outline-none"
                            placeholder="åº—èˆ—åã‚’å…¥åŠ›ã—ã¦ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦ãã ã•ã„"></textarea>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <div id="toast" class="fixed bottom-10 left-1/2 transform -translate-x-1/2 bg-gray-900 text-white px-8 py-3 rounded-full shadow-2xl transition-opacity opacity-0 pointer-events-none z-50 text-sm">
        ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼
    </div>

    <script>
        const STORAGE_KEY = 'GEMINI_API_KEY_INSTA_V3';
        const MODEL_NAME = 'gemini-2.5-flash-preview-09-2025';
        let apiKey = localStorage.getItem(STORAGE_KEY) || "";

        const apiKeyInput = document.getElementById('api-key-input');
        const saveApiBtn = document.getElementById('save-api-btn');
        const shopNameInput = document.getElementById('shop-name');
        const menuRequestInput = document.getElementById('menu-request');
        const additionalInfoInput = document.getElementById('additional-info');
        const generateBtn = document.getElementById('generate-btn');
        const resultText = document.getElementById('result-text');
        const loadingArea = document.getElementById('loading-area');
        const outputArea = document.getElementById('output-area');
        const copyBtn = document.getElementById('copy-btn');
        const toast = document.getElementById('toast');

        if (apiKey) apiKeyInput.value = apiKey;

        saveApiBtn.onclick = () => {
            apiKey = apiKeyInput.value.trim();
            if (apiKey) {
                localStorage.setItem(STORAGE_KEY, apiKey);
                showToast("APIã‚­ãƒ¼ã‚’ä¿å­˜ã—ã¾ã—ãŸ");
            }
        };

        copyBtn.onclick = () => {
            if (!resultText.value) return;
            resultText.select();
            // iFrameåˆ¶ç´„ã®ãŸã‚document.execCommandã‚’ä½¿ç”¨
            document.execCommand('copy');
            showToast("ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã«ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼");
        };

        function showToast(msg) {
            toast.textContent = msg;
            toast.classList.remove('opacity-0');
            setTimeout(() => toast.classList.add('opacity-0'), 2000);
        }

        async function generateCaption() {
            if (!apiKey) return alert("APIã‚­ãƒ¼ã‚’ä¿å­˜ã—ã¦ã‹ã‚‰å®Ÿè¡Œã—ã¦ãã ã•ã„ã€‚");
            if (!shopNameInput.value.trim()) return alert("åº—åã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚");

            loadingArea.classList.remove('hidden');
            outputArea.classList.add('hidden');
            generateBtn.disabled = true;

            const shopName = shopNameInput.value.trim();
            const menuReq = menuRequestInput.value.trim();
            const addInfo = additionalInfoInput.value.trim();

            const systemPrompt = `ã‚ãªãŸã¯é–¢è¥¿ã®äººæ°—ã‚°ãƒ«ãƒ¡ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã€Œï¼ kansai_gurme_alcoã€ã®å°‚å±ãƒ©ã‚¤ã‚¿ãƒ¼ã§ã™ã€‚
Googleæ¤œç´¢ã‚’ä½¿ç”¨ã—ã€åº—èˆ—æƒ…å ±ã¨æŒ‡å®šã•ã‚ŒãŸãƒ¡ãƒ‹ãƒ¥ãƒ¼ã®æœ€æ–°ä¾¡æ ¼ãƒ»å£ã‚³ãƒŸã‚’å¾¹åº•èª¿æŸ»ã—ã€æŒ‡å®šãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã§å‡ºåŠ›ã—ã¦ãã ã•ã„ã€‚

### æ–‡ç« ä½œæˆã®ãƒ«ãƒ¼ãƒ«
- å£èª¿ï¼šè¦ªã—ã¿ã‚„ã™ãã€æ„Ÿæƒ…è±Šã‹ãªã€Œé–¢è¥¿ã®ã‚°ãƒ«ãƒ¡å¢ã€ãƒˆãƒ¼ãƒ³ï¼ˆã€œã‚„ã§ã€ã€œã™ãã‚‹ã€ã€œè‰¯ãâ˜ºï¸ ç­‰ï¼‰ã€‚
- ã€æ„Ÿæƒ³ã€‘æ¬„ã®æ§‹æˆï¼š
    1. åº—å…¨ä½“ã®é›°å›²æ°—ï¼ˆã‚¦ãƒƒãƒ‡ã‚£ã€ãŠæ´’è½ã€æ´»æ°—ãŒã‚ã‚‹ç­‰ï¼‰ã‚’ä¸€è¨€ã€‚
    2. ã€Œä»Šå›ã„ãŸã ã„ãŸãƒ¡ãƒ‹ãƒ¥ãƒ¼ğŸ‘‡ã€ã¨è¨˜è¼‰ã—ã€èª¿æŸ»ã—ãŸãƒ¡ãƒ‹ãƒ¥ãƒ¼åã¨ä¾¡æ ¼ã‚’ã€Œãƒ»ãƒ¡ãƒ‹ãƒ¥ãƒ¼åã€€ã€‡ã€‡å††ã€ã®å½¢å¼ã§ãƒªã‚¹ãƒˆåŒ–ã€‚
    3. ãã®å¾Œã€å„ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’ã€ãƒ¡ãƒ‹ãƒ¥ãƒ¼åã€‘ã§å›²ã¿ã€å‘³ãƒ»é£Ÿæ„Ÿãƒ»é¦™ã‚Šã‚’ã‚·ã‚ºãƒ«æ„ŸãŸã£ã·ã‚Šã«æå†™ã€‚
    4. ã€Œç¾å‘³ã—ã„ã€ã¯ç¦æ­¢ã€‚ã€Œè„‚ã®æ—¨å‘³ãŒæŠ¼ã—å¯„ã›ã‚‹ã€ã€Œå£ã®ä¸­ãŒå¹¸ã›ã€ã€Œé¼»ã«æŠœã‘ã‚‹é¦™ã‚ŠãŒæœ€é«˜ã€ç­‰ã®å…·ä½“çš„ãªæƒ…æ™¯æå†™ã€‚
    5. ã‚¹ãƒãƒ›ã§èª­ã¿ã‚„ã™ã„ã‚ˆã†é©å®œæ”¹è¡Œã€‚
- ã€å®¢å±¤ã€‘ï¼šå£ã‚³ãƒŸã‚’åˆ†æã—ã€ã‚¿ãƒ¼ã‚²ãƒƒãƒˆå±¤ã‚’3ã¤ç®‡æ¡æ›¸ãã€‚
- ã€é›°å›²æ°—ã€‘ï¼šåº—ã®å†…è£…ã‚„å±…å¿ƒåœ°ã‚’ç°¡æ½”ã«ã€‚
- ã€ã‚ªã‚¹ã‚¹ãƒ¡ãƒã‚¤ãƒ³ãƒˆã€‘ï¼šğŸ”¸ã‚’ä½¿ã„3ã¤ã€‚
- ãƒãƒƒã‚·ãƒ¥ã‚¿ã‚°ï¼šæœ€å¾Œã«é–¢é€£ã™ã‚‹ãƒãƒƒã‚·ãƒ¥ã‚¿ã‚°ã‚’5ã¤ã€‚

### å‡ºåŠ›ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
ã‚‚ã—æ°—ã«ãªã£ãŸã‚‰ä¿å­˜ã‚’ã‚¿ãƒƒãƒ—ï¼
æ¬¡ã®æŠ•ç¨¿ã‚‚æ°—ã«ãªã£ãŸã‚‰ãƒ•ã‚©ãƒ­ãƒ¼ãŠé¡˜ã„ã—ã¾ã™ğŸ”¥
â†’@kansai_gurme_alco

ã€ã‚ªã‚¹ã‚¹ãƒ¡ãƒã‚¤ãƒ³ãƒˆã€‘
ğŸ”¸
ğŸ”¸
ğŸ”¸

ã€æ„Ÿæƒ³ã€‘
[é›°å›²æ°—ã®ä¸€è¨€]

ä»Šå›ã„ãŸã ã„ãŸãƒ¡ãƒ‹ãƒ¥ãƒ¼ğŸ‘‡
ãƒ»[ãƒ¡ãƒ‹ãƒ¥ãƒ¼1]ã€€[ä¾¡æ ¼]
ãƒ»[ãƒ¡ãƒ‹ãƒ¥ãƒ¼2]ã€€[ä¾¡æ ¼]
...

ã€[ãƒ¡ãƒ‹ãƒ¥ãƒ¼1]ã€‘
[å…·ä½“çš„ã§ã‚·ã‚ºãƒ«æ„Ÿã®ã‚ã‚‹æ„Ÿæƒ³]

ã€[ãƒ¡ãƒ‹ãƒ¥ãƒ¼2]ã€‘
[å…·ä½“çš„ã§ã‚·ã‚ºãƒ«æ„Ÿã®ã‚ã‚‹æ„Ÿæƒ³]

[ç· ã‚ã®ä¸€è¨€ã€‚æ–‡ç« ã‚’æ›¸ã„ã¦ã¦ãŠè…¹ãŒç©ºãã‚ˆã†ãªè¡¨ç¾]

ã€å®¢å±¤ã€‘
ãƒ»
ãƒ»
ãƒ»

ã€é›°å›²æ°—ã€‘


â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”
ğŸ“åº—æƒ…å ±
åº—åï¼š[åº—å]
ä½æ‰€ï¼š[æ­£ç¢ºãªä½æ‰€]
å–¶æ¥­ï¼š[å–¶æ¥­æ™‚é–“ï¼ˆå®šä¼‘æ—¥å«ã‚€ï¼‰]
â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”
é–¢è¥¿ã®ã‚°ãƒ«ãƒ¡æƒ…å ±ã‚’ç™ºä¿¡ä¸­ï¼
å±…é…’å±‹ã€ã‚«ãƒ•ã‚§ã€è“å­ç³»ã€ä¼šé£Ÿã«åˆ©ç”¨ã§ãã‚‹ãŠåº—ã‚’ç´¹ä»‹ï¼
â†“
@kansai_gurme_alco

#ã‚¿ã‚°1 #ã‚¿ã‚°2 #ã‚¿ã‚°3 #ã‚¿ã‚°4 #ã‚¿ã‚°5`;

            const userQuery = `åº—å: ${shopName}\né£Ÿã¹ãŸãƒ¡ãƒ‹ãƒ¥ãƒ¼/èª¿æŸ»è¦æœ›: ${menuReq}\nè£œè¶³: ${addInfo}`;

            try {
                const response = await fetchWithRetry(
                    `https://generativelanguage.googleapis.com/v1beta/models/${MODEL_NAME}:generateContent?key=${apiKey}`,
                    {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            contents: [{ parts: [{ text: userQuery }] }],
                            systemInstruction: { parts: [{ text: systemPrompt }] },
                            tools: [{ google_search: {} }]
                        })
                    }
                );

                const data = await response.json();
                const text = data.candidates?.[0]?.content?.parts?.[0]?.text;
                if (text) {
                    resultText.value = text.trim();
                } else {
                    throw new Error("æƒ…å ±ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸã€‚");
                }
            } catch (error) {
                resultText.value = "âš ï¸ ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ:\n" + error.message;
            } finally {
                loadingArea.classList.add('hidden');
                outputArea.classList.remove('hidden');
                generateBtn.disabled = false;
            }
        }

        async function fetchWithRetry(url, options, retries = 5) {
            let delay = 1000;
            for (let i = 0; i < retries; i++) {
                try {
                    const res = await fetch(url, options);
                    if (res.ok) return res;
                    const errData = await res.json();
                    if (res.status === 429 || res.status >= 500) {
                        // Retry logic
                    } else {
                        throw new Error(errData.error?.message || "ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚¨ãƒ©ãƒ¼");
                    }
                } catch (e) {
                    if (i === retries - 1) throw e;
                }
                await new Promise(r => setTimeout(r, delay));
                delay *= 2;
            }
        }

        generateBtn.onclick = generateCaption;
    </script>
</body>
</html>

