<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ã‚¤ãƒ³ã‚¹ã‚¿æŠ•ç¨¿ã‚­ãƒ£ãƒ—ã‚·ãƒ§ãƒ³ç”Ÿæˆãã‚“ V3</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;700&display=swap');
        body { font-family: 'Noto Sans JP', sans-serif; }
        .loading-spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border-left-color: #F43F5E;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        textarea::-webkit-scrollbar {
            width: 8px;
        }
        textarea::-webkit-scrollbar-thumb {
            background: #e2e8f0;
            border-radius: 4px;
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen text-gray-800">

    <nav class="bg-white shadow-sm border-b px-6 py-4 sticky top-0 z-50">
        <div class="max-w-6xl mx-auto flex justify-between items-center">
            <h1 class="text-xl font-bold bg-gradient-to-r from-rose-500 to-orange-500 bg-clip-text text-transparent">
                ğŸ“¸ ã‚¤ãƒ³ã‚¹ã‚¿æŠ•ç¨¿ç”Ÿæˆ V3
            </h1>
            <div class="flex items-center gap-3">
                <a href="https://aistudio.google.com/app/apikey" target="_blank" class="hidden sm:block text-xs bg-gray-100 text-gray-600 px-3 py-2 rounded-lg hover:bg-gray-200 transition">
                    APIã‚­ãƒ¼å–å¾—
                </a>
                <button id="copy-btn" class="bg-rose-500 text-white px-5 py-2 rounded-xl hover:bg-rose-600 transition font-bold text-sm shadow-md">
                    ã‚³ãƒ”ãƒ¼
                </button>
            </div>
        </div>
    </nav>

    <main class="max-w-6xl mx-auto px-4 py-8">
        <div class="grid grid-cols-1 lg:grid-cols-12 gap-8">
            
            <!-- Left Panel -->
            <div class="lg:col-span-5 space-y-6">
                <!-- API Section -->
                <div class="bg-white p-5 rounded-3xl shadow-sm border">
                    <label class="block text-xs font-bold text-gray-400 uppercase mb-2 ml-1">Google Gemini API Key</label>
                    <div class="flex gap-2">
                        <input type="password" id="api-key-input" placeholder="APIã‚­ãƒ¼ã‚’å…¥åŠ›" 
                            class="flex-1 border border-gray-200 rounded-2xl px-4 py-2 text-sm focus:ring-2 focus:ring-rose-500 outline-none">
                        <button id="save-api-btn" class="bg-gray-800 text-white px-4 py-2 rounded-2xl hover:bg-black transition text-sm">
                            ä¿å­˜
                        </button>
                    </div>
                </div>

                <!-- Input Form -->
                <div class="bg-white p-6 rounded-3xl shadow-sm border space-y-5">
                    <h2 class="text-lg font-bold border-l-4 border-rose-500 pl-3">åº—èˆ—ãƒ»ãƒ¡ãƒ‹ãƒ¥ãƒ¼èª¿æŸ»</h2>
                    
                    <div>
                        <label class="block text-sm font-bold text-gray-700 mb-2">åº—å</label>
                        <input type="text" id="shop-name" placeholder="ä¾‹ï¼šå®ˆå£ ç«‹ã¡å‘‘ã¿ ãƒ¨ãƒƒã‚³ã‚¤ã‚·ãƒ§" 
                            class="w-full border border-gray-200 rounded-2xl px-4 py-3 focus:ring-2 focus:ring-rose-500 outline-none transition">
                    </div>

                    <div>
                        <label class="block text-sm font-bold text-gray-700 mb-2">é£Ÿã¹ãŸã‚‚ã®ãƒ»èª¿æŸ»ãƒ¡ãƒ‹ãƒ¥ãƒ¼</label>
                        <textarea id="menu-request" rows="4" placeholder="ä¾‹ï¼šè‚‰åˆºã—ç››ã‚Šã€ç‡»è£½3ç¨®ç››ã‚Šã€è‚åˆºã—ã€‚å€¤æ®µã¨å‘³ã®æ„Ÿæƒ³ã‚’è©³ã—ãï¼" 
                            class="w-full border border-gray-200 rounded-2xl px-4 py-3 focus:ring-2 focus:ring-rose-500 outline-none transition"></textarea>
                    </div>

                    <div>
                        <label class="block text-sm font-bold text-gray-700 mb-2">è£œè¶³ï¼ˆåº—ã®é›°å›²æ°—ã®è¦æœ›ãªã©ï¼‰</label>
                        <input type="text" id="additional-info" placeholder="ä¾‹ï¼šã‚¦ãƒƒãƒ‡ã‚£ã§ãŠæ´’è½ãªæ„Ÿã˜" 
                            class="w-full border border-gray-200 rounded-2xl px-4 py-3 focus:ring-2 focus:ring-rose-500 outline-none transition">
                    </div>

                    <button id="generate-btn" class="w-full bg-gradient-to-br from-rose-500 to-orange-500 text-white font-bold py-4 rounded-2xl shadow-lg hover:shadow-xl transition transform active:scale-[0.98] flex justify-center items-center gap-2">
                        <span>ğŸš€ ãƒãƒƒãƒˆèª¿æŸ»ã‚’é–‹å§‹</span>
                    </button>
                </div>
            </div>

            <!-- Right Panel (Output) -->
            <div class="lg:col-span-7">
                <div class="bg-white p-6 rounded-3xl shadow-sm border h-full flex flex-col min-h-[700px]">
                    <div id="loading-area" class="hidden flex-1 flex flex-col items-center justify-center text-gray-500">
                        <div class="loading-spinner mb-6"></div>
                        <p class="text-lg font-bold text-gray-700">æœ€æ–°æƒ…å ±ã‚’ãƒªã‚µãƒ¼ãƒä¸­...</p>
                        <p class="text-sm mt-2 text-gray-400 text-center">ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã®ä¾¡æ ¼ã‚„å£ã‚³ãƒŸã‚’åˆ†æã—ã¦ã„ã¾ã™ã€‚<br>15ã€œ30ç§’ã»ã©ãŠå¾…ã¡ãã ã•ã„ã€‚</p>
                    </div>

                    <div id="output-area" class="flex-1 flex flex-col">
                        <textarea id="result-text" readonly 
                            class="w-full flex-1 bg-gray-50 border-none resize-none p-6 rounded-2xl text-gray-800 leading-relaxed text-[15px] focus:outline-none"
                            placeholder="ã“ã“ã«è‡ªå‹•ç”Ÿæˆã•ã‚ŒãŸæ–‡ç« ãŒè¡¨ç¤ºã•ã‚Œã¾ã™"></textarea>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <div id="toast" class="fixed bottom-10 left-1/2 transform -translate-x-1/2 bg-gray-900 text-white px-8 py-3 rounded-full shadow-2xl transition-opacity opacity-0 pointer-events-none z-50">
        ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼
    </div>

    <script>
        const STORAGE_KEY = 'GEMINI_API_KEY_INSTA_V3';
        const MODEL_NAME = 'gemini-2.5-flash-preview-09-2025';
        let apiKey = localStorage.getItem(STORAGE_KEY) || "";

        const apiKeyInput = document.getElementById('api-key-input');
        const saveApiBtn = document.getElementById('save-api-btn');
        const shopNameInput = document.getElementById('shop-name');
        const menuRequestInput = document.getElementById('menu-request');
        const additionalInfoInput = document.getElementById('additional-info');
        const generateBtn = document.getElementById('generate-btn');
        const resultText = document.getElementById('result-text');
        const loadingArea = document.getElementById('loading-area');
        const outputArea = document.getElementById('output-area');
        const copyBtn = document.getElementById('copy-btn');
        const toast = document.getElementById('toast');

        if (apiKey) apiKeyInput.value = apiKey;

        saveApiBtn.onclick = () => {
            apiKey = apiKeyInput.value.trim();
            localStorage.setItem(STORAGE_KEY, apiKey);
            showToast("APIã‚­ãƒ¼ã‚’ä¿å­˜ã—ã¾ã—ãŸ");
        };

        copyBtn.onclick = () => {
            if (!resultText.value) return;
            resultText.select();
            document.execCommand('copy');
            showToast("ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼");
        };

        function showToast(msg) {
            toast.textContent = msg;
            toast.classList.remove('opacity-0');
            setTimeout(() => toast.classList.add('opacity-0'), 2000);
        }

        async function generateCaption() {
            if (!apiKey) return alert("APIã‚­ãƒ¼ã‚’è¨­å®šã—ã¦ãã ã•ã„ã€‚");
            if (!shopNameInput.value.trim()) return alert("åº—åã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚");

            loadingArea.classList.remove('hidden');
            outputArea.classList.add('hidden');
            generateBtn.disabled = true;

            const shopName = shopNameInput.value.trim();
            const menuReq = menuRequestInput.value.trim();
            const addInfo = additionalInfoInput.value.trim();

            const systemPrompt = `ã‚ãªãŸã¯é–¢è¥¿ã®äººæ°—ã‚°ãƒ«ãƒ¡ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã€Œï¼ kansai_gurme_alcoã€ã®ãƒ©ã‚¤ã‚¿ãƒ¼ã§ã™ã€‚
Googleæ¤œç´¢ã‚’é§†ä½¿ã—ã¦ã€åº—èˆ—æƒ…å ±ã¨æŒ‡å®šã•ã‚ŒãŸãƒ¡ãƒ‹ãƒ¥ãƒ¼ã®æœ€æ–°ä¾¡æ ¼ãƒ»å£ã‚³ãƒŸã‚’èª¿æŸ»ã—ã€ä»¥ä¸‹ã®ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã§å‡ºåŠ›ã—ã¦ãã ã•ã„ã€‚

### æ–‡ç« ä½œæˆã®ãƒ«ãƒ¼ãƒ«
- å£èª¿ï¼šè¦ªã—ã¿ã‚„ã™ãã€å°‘ã—æ„Ÿæƒ…ãŒæ¼ã‚Œå‡ºã‚‹ã‚ˆã†ãªã€Œé–¢è¥¿ã®ã‚°ãƒ«ãƒ¡å¥½ãã€ã‚‰ã—ã„ãƒˆãƒ¼ãƒ³ï¼ˆã€œã‚„ã§ã€ã€œã™ãã‚‹ã€ã€œè‰¯ãâ˜ºï¸ ç­‰ï¼‰ã€‚
- ã€æ„Ÿæƒ³ã€‘æ¬„ï¼š
    1. ã¾ãšã€Œä»Šå›ã„ãŸã ã„ãŸãƒ¡ãƒ‹ãƒ¥ãƒ¼ğŸ‘‡ã€ã¨ã—ã¦ã€èª¿æŸ»ã—ãŸãƒ¡ãƒ‹ãƒ¥ãƒ¼åã¨ä¾¡æ ¼ã‚’ãƒªã‚¹ãƒˆå½¢å¼ï¼ˆãƒ»ãƒ¡ãƒ‹ãƒ¥ãƒ¼åã€€ã€‡ã€‡å††ï¼‰ã§è¨˜è¼‰ã—ã¦ãã ã•ã„ã€‚ä¾¡æ ¼ã¯ãƒãƒƒãƒˆä¸Šã®æœ€æ–°æƒ…å ±ã‚’åæ˜ ã•ã›ã¦ãã ã•ã„ã€‚
    2. ãã®å¾Œã€å„ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’ã€ãƒ¡ãƒ‹ãƒ¥ãƒ¼åã€‘ã§å›²ã¿ã€å‘³ã®æ„Ÿæƒ³ã‚’è©³ã—ãæ›¸ã„ã¦ãã ã•ã„ã€‚
    3. ã€Œç¾å‘³ã—ã„ã€ã®ä»£ã‚ã‚Šã«ã€Œè„‚ãŒå™›ã‚€ãŸã³ã«æº¢ã‚Œã‚‹ã€ã€Œé¦™ã‚ŠãŒé¼»ã‚’æŠœã‘ã‚‹ã€ã€Œé®®åº¦ã®è‰¯ã•ãŒä¸€å£ã§ã‚ã‹ã‚‹ã€ãªã©ã€å‘³ã®æƒ…æ™¯ãŒæµ®ã‹ã¶è¡¨ç¾ã‚’ä½¿ã£ã¦ãã ã•ã„ã€‚
    4. é©åº¦ã«æ”¹è¡Œã‚’å…¥ã‚Œã€ã‚¹ãƒãƒ›ã§èª­ã¿ã‚„ã™ãã—ã¦ãã ã•ã„ã€‚
- ã€å®¢å±¤ã€‘ï¼šãƒãƒƒãƒˆã®å£ã‚³ãƒŸã‹ã‚‰åˆ†æã—ã€3ã¤ã®ç®‡æ¡æ›¸ãã§ã€‚
- ã€é›°å›²æ°—ã€‘ï¼šåº—ã®å†…è£…ã‚„æ´»æ°—ã‚’ç°¡æ½”ã«ã€‚
- ã€ã‚ªã‚¹ã‚¹ãƒ¡ãƒã‚¤ãƒ³ãƒˆã€‘ï¼šğŸ”¸ã‚’ä½¿ã„ã€ãã®åº—ã®å¼·ã¿ã‚’3ã¤ã€‚
- ãƒãƒƒã‚·ãƒ¥ã‚¿ã‚°ï¼šæœ€å¾Œã«é–¢é€£ã‚¿ã‚°ã‚’5ã¤ã€‚

### å‡ºåŠ›ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
ã‚‚ã—æ°—ã«ãªã£ãŸã‚‰ä¿å­˜ã‚’ã‚¿ãƒƒãƒ—ï¼
æ¬¡ã®æŠ•ç¨¿ã‚‚æ°—ã«ãªã£ãŸã‚‰ãƒ•ã‚©ãƒ­ãƒ¼ãŠé¡˜ã„ã—ã¾ã™ğŸ”¥
â†’@kansai_gurme_alco

ã€ã‚ªã‚¹ã‚¹ãƒ¡ãƒã‚¤ãƒ³ãƒˆã€‘
ğŸ”¸
ğŸ”¸
ğŸ”¸

ã€æ„Ÿæƒ³ã€‘
[ã“ã“ã«åº—å…¨ä½“ã®é›°å›²æ°—ã‚„å±…å¿ƒåœ°ã‚’ä¸€è¨€ã€‚ä¾‹ï¼šåº—å†…ã¯ã‚¦ãƒƒãƒ‡ã‚£ã§æ˜ã‚‹ãã€œ]

ä»Šå›ã„ãŸã ã„ãŸãƒ¡ãƒ‹ãƒ¥ãƒ¼ğŸ‘‡
ãƒ»[ãƒ¡ãƒ‹ãƒ¥ãƒ¼1]ã€€[ä¾¡æ ¼]
ãƒ»[ãƒ¡ãƒ‹ãƒ¥ãƒ¼2]ã€€[ä¾¡æ ¼]
...

ã€[ãƒ¡ãƒ‹ãƒ¥ãƒ¼1]ã€‘
[å…·ä½“çš„ã§ã‚·ã‚ºãƒ«æ„Ÿã®ã‚ã‚‹æ„Ÿæƒ³]

ã€[ãƒ¡ãƒ‹ãƒ¥ãƒ¼2]ã€‘
[å…·ä½“çš„ã§ã‚·ã‚ºãƒ«æ„Ÿã®ã‚ã‚‹æ„Ÿæƒ³]

[ç· ã‚ã®ä¸€è¨€ã€‚ä¾‹ï¼šã¾ãŸè¡ŒããŸããªã‚‹ã€œ]

ã€å®¢å±¤ã€‘
ãƒ»
ãƒ»
ãƒ»

ã€é›°å›²æ°—ã€‘


â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”
ğŸ“åº—æƒ…å ±
åº—åï¼š[åº—å]
ä½æ‰€ï¼š[æ­£ç¢ºãªä½æ‰€]
å–¶æ¥­ï¼š[å–¶æ¥­æ™‚é–“ï¼ˆå®šä¼‘æ—¥å«ã‚€ï¼‰]
â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”
é–¢è¥¿ã®ã‚°ãƒ«ãƒ¡æƒ…å ±ã‚’ç™ºä¿¡ä¸­ï¼
å±…é…’å±‹ã€ã‚«ãƒ•ã‚§ã€è“å­ç³»ã€ä¼šé£Ÿã«åˆ©ç”¨ã§ãã‚‹ãŠåº—ã‚’ç´¹ä»‹ï¼
â†“
@kansai_gurme_alco

#ã‚¿ã‚°1 #ã‚¿ã‚°2 #ã‚¿ã‚°3 #ã‚¿ã‚°4 #ã‚¿ã‚°5`;

            const userQuery = `åº—å: ${shopName}\né£Ÿã¹ãŸãƒ¡ãƒ‹ãƒ¥ãƒ¼/èª¿ã¹ãŸã„ã“ã¨: ${menuReq}\nè£œè¶³: ${addInfo}`;

            try {
                const response = await fetchWithRetry(
                    `https://generativelanguage.googleapis.com/v1beta/models/${MODEL_NAME}:generateContent?key=${apiKey}`,
                    {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            contents: [{ parts: [{ text: userQuery }] }],
                            systemInstruction: { parts: [{ text: systemPrompt }] },
                            tools: [{ google_search: {} }]
                        })
                    }
                );

                const data = await response.json();
                const text = data.candidates?.[0]?.content?.parts?.[0]?.text;
                if (text) {
                    resultText.value = text.trim();
                } else {
                    throw new Error("ç”Ÿæˆã«å¤±æ•—ã—ã¾ã—ãŸã€‚");
                }
            } catch (error) {
                resultText.value = "ã‚¨ãƒ©ãƒ¼: " + error.message;
            } finally {
                loadingArea.classList.add('hidden');
                outputArea.classList.remove('hidden');
                generateBtn.disabled = false;
            }
        }

        async function fetchWithRetry(url, options, retries = 5) {
            let delay = 1000;
            for (let i = 0; i < retries; i++) {
                try {
                    const res = await fetch(url, options);
                    if (res.ok) return res;
                    if (res.status !== 429 && res.status < 500) {
                        const err = await res.json();
                        throw new Error(err.error?.message || "ã‚¨ãƒ©ãƒ¼");
                    }
                } catch (e) {
                    if (i === retries - 1) throw e;
                }
                await new Promise(r => setTimeout(r, delay));
                delay *= 2;
            }
        }

        generateBtn.onclick = generateCaption;
    </script>
</body>
</html>

