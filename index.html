<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ã‚¤ãƒ³ã‚¹ã‚¿æŠ•ç¨¿ã‚­ãƒ£ãƒ—ã‚·ãƒ§ãƒ³ç”Ÿæˆãã‚“</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;700&display=swap');
        body { font-family: 'Noto Sans JP', sans-serif; }
        .loading-spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            width: 36px;
            height: 36px;
            border-radius: 50%;
            border-left-color: #4F46E5;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen pb-12">

    <!-- Header -->
    <nav class="bg-white shadow-sm border-b px-4 py-4 mb-6">
        <div class="max-w-4xl mx-auto flex justify-between items-center">
            <h1 class="text-xl font-bold text-gray-800">ğŸ“¸ ã‚¤ãƒ³ã‚¹ã‚¿æŠ•ç¨¿ç”Ÿæˆãƒ„ãƒ¼ãƒ«</h1>
            <div class="flex gap-2">
                <a href="https://aistudio.google.com/app/apikey" target="_blank" class="text-xs bg-orange-100 text-orange-700 px-3 py-2 rounded-lg hover:bg-orange-200 transition">
                    ğŸ”‘ APIå–å¾—
                </a>
            </div>
        </div>
    </nav>

    <main class="max-w-4xl mx-auto px-4">
        
        <!-- API Setting Section -->
        <section id="api-section" class="bg-white p-6 rounded-2xl shadow-sm border mb-6">
            <h2 class="text-lg font-bold mb-4 flex items-center gap-2">
                âš™ï¸ åˆæœŸè¨­å®š
            </h2>
            <div class="flex flex-col sm:flex-row gap-3">
                <input type="password" id="api-key-input" placeholder="Google Gemini APIã‚­ãƒ¼ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„" 
                    class="flex-1 border border-gray-300 rounded-xl px-4 py-2 focus:ring-2 focus:ring-indigo-500 outline-none">
                <button id="save-api-btn" class="bg-indigo-600 text-white px-6 py-2 rounded-xl hover:bg-indigo-700 transition font-medium">
                    ã‚­ãƒ¼ã‚’ä¿å­˜
                </button>
            </div>
            <p id="api-status" class="mt-2 text-sm text-gray-500 italic"></p>
        </section>

        <!-- Main Input Form -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            
            <!-- Input Side -->
            <section class="bg-white p-6 rounded-2xl shadow-sm border">
                <h2 class="text-lg font-bold mb-4">ğŸ  åº—èˆ—æƒ…å ±å…¥åŠ›</h2>
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">åº—å (å¿…é ˆ)</label>
                        <input type="text" id="shop-name" placeholder="ä¾‹ï¼šæ¢…ç”° ã‚«ãƒ•ã‚§ ã€‡ã€‡" 
                            class="w-full border border-gray-300 rounded-xl px-4 py-3 focus:ring-2 focus:ring-indigo-500 outline-none">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">è£œè¶³æƒ…å ± (ä»»æ„)</label>
                        <textarea id="additional-info" rows="3" placeholder="ä¾‹ï¼šé™å®šã®ãƒ‘ãƒ•ã‚§ãŒæœ‰åã€‚å†…è£…ãŒã‚ªã‚·ãƒ£ãƒ¬ãªã©" 
                            class="w-full border border-gray-300 rounded-xl px-4 py-3 focus:ring-2 focus:ring-indigo-500 outline-none"></textarea>
                    </div>
                    <button id="generate-btn" class="w-full bg-gradient-to-r from-pink-500 to-indigo-600 text-white font-bold py-4 rounded-xl shadow-lg hover:opacity-90 transition transform active:scale-95 flex justify-center items-center gap-2">
                        <span>ğŸš€ ãƒãƒƒãƒˆã§èª¿æŸ»ã—ã¦ä½œæˆ</span>
                    </button>
                </div>
            </section>

            <!-- Output Side -->
            <section class="bg-white p-6 rounded-2xl shadow-sm border flex flex-col min-h-[400px]">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-lg font-bold">ğŸ“ ç”Ÿæˆçµæœ</h2>
                    <button id="copy-btn" class="text-sm bg-gray-100 text-gray-600 px-3 py-1 rounded-md hover:bg-gray-200 active:bg-gray-300 disabled:opacity-50">
                        ğŸ“‹ ã‚³ãƒ”ãƒš
                    </button>
                </div>
                
                <div id="loading-area" class="hidden flex-1 flex flex-col items-center justify-center text-gray-500">
                    <div class="loading-spinner mb-4"></div>
                    <p>ãƒãƒƒãƒˆã®æƒ…å ±ã‚’èª¿æŸ»ä¸­...</p>
                </div>

                <div id="output-area" class="flex-1">
                    <textarea id="result-text" readonly 
                        class="w-full h-full min-h-[300px] bg-gray-50 border-none resize-none p-4 rounded-xl text-gray-800 leading-relaxed text-sm focus:outline-none"
                        placeholder="ã“ã“ã«ç”Ÿæˆã•ã‚ŒãŸã‚­ãƒ£ãƒ—ã‚·ãƒ§ãƒ³ãŒè¡¨ç¤ºã•ã‚Œã¾ã™"></textarea>
                </div>
            </section>
        </div>
    </main>

    <!-- Message Toast -->
    <div id="toast" class="fixed bottom-10 left-1/2 transform -translate-x-1/2 bg-black text-white px-6 py-3 rounded-full shadow-2xl transition-opacity opacity-0 pointer-events-none z-50">
        ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼
    </div>

    <script>
        // Constants & State
        const STORAGE_KEY = 'GEMINI_API_KEY_INSTA_GEN';
        const MODEL_NAME = 'gemini-2.5-flash-preview-09-2025';
        let apiKey = localStorage.getItem(STORAGE_KEY) || "";

        // Elements
        const apiKeyInput = document.getElementById('api-key-input');
        const saveApiBtn = document.getElementById('save-api-btn');
        const apiStatus = document.getElementById('api-status');
        const shopNameInput = document.getElementById('shop-name');
        const additionalInfoInput = document.getElementById('additional-info');
        const generateBtn = document.getElementById('generate-btn');
        const resultText = document.getElementById('result-text');
        const loadingArea = document.getElementById('loading-area');
        const outputArea = document.getElementById('output-area');
        const copyBtn = document.getElementById('copy-btn');
        const toast = document.getElementById('toast');

        // Init
        if (apiKey) {
            apiKeyInput.value = apiKey;
            apiStatus.textContent = "âœ… APIã‚­ãƒ¼ã¯ä¿å­˜ã•ã‚Œã¦ã„ã¾ã™";
        }

        // Actions
        saveApiBtn.onclick = () => {
            const val = apiKeyInput.value.trim();
            if (val) {
                apiKey = val;
                localStorage.setItem(STORAGE_KEY, val);
                apiStatus.textContent = "âœ… APIã‚­ãƒ¼ã‚’ä¿å­˜ã—ã¾ã—ãŸ";
                showToast("ä¿å­˜å®Œäº†");
            }
        };

        copyBtn.onclick = () => {
            if (!resultText.value) return;
            resultText.select();
            document.execCommand('copy');
            showToast("ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã«ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼");
        };

        function showToast(msg) {
            toast.textContent = msg;
            toast.classList.remove('opacity-0');
            setTimeout(() => toast.classList.add('opacity-0'), 2000);
        }

        async function generateCaption() {
            if (!apiKey) {
                alert("å…ˆã«APIã‚­ãƒ¼ã‚’è¨­å®šãƒ»ä¿å­˜ã—ã¦ãã ã•ã„ã€‚");
                return;
            }
            if (!shopNameInput.value.trim()) {
                alert("åº—åã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚");
                return;
            }

            // UI State
            loadingArea.classList.remove('hidden');
            outputArea.classList.add('hidden');
            generateBtn.disabled = true;

            const shopName = shopNameInput.value.trim();
            const addInfo = additionalInfoInput.value.trim();

            const systemPrompt = `ã‚ãªãŸã¯é–¢è¥¿ã®ã‚°ãƒ«ãƒ¡æƒ…å ±ã‚’ç™ºä¿¡ã™ã‚‹ã‚¤ãƒ³ã‚¹ã‚¿ã‚°ãƒ©ãƒãƒ¼ã§ã™ã€‚
Googleæ¤œç´¢ãƒ„ãƒ¼ãƒ«ã‚’ä½¿ç”¨ã—ã¦ã€æä¾›ã•ã‚ŒãŸåº—åã«ã¤ã„ã¦ä»¥ä¸‹ã®æƒ…å ±ã‚’èª¿æŸ»ã—ã€æŒ‡å®šã•ã‚ŒãŸãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã§ã‚­ãƒ£ãƒ—ã‚·ãƒ§ãƒ³ã‚’ä½œæˆã—ã¦ãã ã•ã„ã€‚

ã€èª¿æŸ»é …ç›®ã€‘
1. åº—ã®æ­£ç¢ºãªåç§°
2. æ­£ç¢ºãªä½æ‰€
3. å–¶æ¥­æ™‚é–“ï¼ˆæœ€æ–°æƒ…å ±ï¼‰
4. æœ€å¯„ã‚Šé§…
5. ãƒãƒƒãƒˆä¸Šã®å£ã‚³ãƒŸï¼ˆSNSã‚„é£Ÿã¹ãƒ­ã‚°ç­‰ã®æ„Ÿæƒ³ã‚’è¦ªã—ã¿ã‚„ã™ã„æ–‡ç« ã§150æ–‡å­—ç¨‹åº¦ã«è¦ç´„ï¼‰

ã€å‡ºåŠ›ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã€‘
ã‚‚ã—æ°—ã«ãªã£ãŸã‚‰ä¿å­˜ã‚’ã‚¿ãƒƒãƒ—ï¼
æ¬¡ã®æŠ•ç¨¿ã‚‚æ°—ã«ãªã£ãŸã‚‰ãƒ•ã‚©ãƒ­ãƒ¼ãŠé¡˜ã„ã—ã¾ã™ğŸ”¥
â†’ï¼ kansai_gurme_alco

[ã“ã“ã«ãƒãƒƒãƒˆã®å£ã‚³ãƒŸã¾ã¨ã‚æ–‡ã‚’è¨˜è¼‰]
--------------------------------------------
ğŸ“åº—æƒ…å ±
åº—åï¼š[åº—å]
ä½æ‰€ï¼š[ä½æ‰€]
å–¶æ¥­ï¼š[å–¶æ¥­æ™‚é–“]
æœ€å¯„ï¼š[æœ€å¯„ã‚Šé§…]
--------------------------------------------
é–¢è¥¿ã®ã‚°ãƒ«ãƒ¡æƒ…å ±ã‚’ç™ºä¿¡ä¸­ï¼
å±…é…’å±‹ã€ã‚«ãƒ•ã‚§ã€è“å­ç³»ã€ä¼šé£Ÿã«åˆ©ç”¨ã§ãã‚‹ãŠåº—ã‚’ç´¹ä»‹ï¼
â†“
ï¼ kansai_gurme_alco

ã€æ³¨æ„äº‹é …ã€‘
- ã€Œ[ã“ã“ã«ãƒãƒƒãƒˆã®å£ã‚³ãƒŸã¾ã¨ã‚æ–‡ã‚’è¨˜è¼‰]ã€ãªã©ã®ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼ã¯å¿…ãšå®Ÿéš›ã®æƒ…å ±ã«ç½®ãæ›ãˆã¦ãã ã•ã„ã€‚
- åˆ†ã‹ã‚‰ãªã„é …ç›®ãŒã‚ã‚‹å ´åˆã¯ã€ä¸è‡ªç„¶ãªå›ç­”ã¯é¿ã‘ã€ç©ºæ¬„ã«ã›ãšã€Œèª¿æŸ»ä¸­ã€ã‚„ã€Œè¦ç¢ºèªã€ã¨ã—ã¦ãã ã•ã„ã€‚
- æ—¥æœ¬èªã§å‡ºåŠ›ã—ã¦ãã ã•ã„ã€‚`;

            const userQuery = `åº—å: ${shopName}\nè£œè¶³æƒ…å ±: ${addInfo}`;

            try {
                const response = await fetchWithRetry(
                    `https://generativelanguage.googleapis.com/v1beta/models/${MODEL_NAME}:generateContent?key=${apiKey}`,
                    {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            contents: [{ parts: [{ text: userQuery }] }],
                            systemInstruction: { parts: [{ text: systemPrompt }] },
                            tools: [{ google_search: {} }]
                        })
                    }
                );

                const data = await response.json();
                const text = data.candidates?.[0]?.content?.parts?.[0]?.text;

                if (text) {
                    resultText.value = text.trim();
                } else {
                    throw new Error("ç”Ÿæˆã«å¤±æ•—ã—ã¾ã—ãŸã€‚");
                }

            } catch (error) {
                console.error(error);
                resultText.value = "ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸï¼š\n" + error.message;
            } finally {
                loadingArea.classList.add('hidden');
                outputArea.classList.remove('hidden');
                generateBtn.disabled = false;
            }
        }

        async function fetchWithRetry(url, options, retries = 5) {
            let delay = 1000;
            for (let i = 0; i < retries; i++) {
                try {
                    const res = await fetch(url, options);
                    if (res.ok) return res;
                    if (res.status === 429 || res.status >= 500) {
                        // Rate limit or server error, retry
                    } else {
                        const errData = await res.json();
                        throw new Error(errData.error?.message || "ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚¨ãƒ©ãƒ¼");
                    }
                } catch (e) {
                    if (i === retries - 1) throw e;
                }
                await new Promise(r => setTimeout(r, delay));
                delay *= 2;
            }
        }

        generateBtn.onclick = generateCaption;

    </script>
</body>
</html>
